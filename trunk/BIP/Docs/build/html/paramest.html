<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Parameter Estimation in Dynamic Models &mdash; BIP - Bayesian Inference with Python v0.3 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.3',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BIP - Bayesian Inference with Python v0.3 documentation" href="index.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">BIP</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/BIP.png" alt="Logo"/>
            </a></p>
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Parameter Estimation in Dynamic Models</a><ul>
<li><a class="reference external" href="#example-usage">Example Usage</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="overview.html"
                                  title="previous chapter">Overview</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/paramest.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="parameter-estimation-in-dynamic-models">
<h1>Parameter Estimation in Dynamic Models<a class="headerlink" href="#parameter-estimation-in-dynamic-models" title="Permalink to this headline">¶</a></h1>
<p>A growing theme in mathamatical modeling is uncertainty analysis. The Melding Module provides a Bayesian framework to analyze uncertainty in mathematical models. It includes tools that allow modellers to integrate Prior information about the model&#8217;s parameters and variables into the model, in order to explore the full uncertainty associated with a model.</p>
<p>Once a model is thus parameterized, we can simulate the model, with full uncertainty representation and also fit the model to available data to reduce that uncertaity. Markov chain Monte Carlo algorithms are at the core of the framework, which requires a large number of simulations of the models in order to explore parameter space.</p>
<div class="section" id="example-usage">
<h2>Example Usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h2>
<p>This first example includes a simple ODE (an epidemic model) model which is fitted against simulated data to which noise is added:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">BIP.Bayes.Melding</span> <span class="kn">import</span> <span class="n">FitModel</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#Transmission coefficient</span>
<span class="n">tau</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span> <span class="c">#infectious period. FIXED</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mi">36</span>
<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">999</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="o">*</span><span class="n">theta</span><span class="p">):</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">sir</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
                <span class="sd">&#39;&#39;&#39;ODE model&#39;&#39;&#39;</span>
                <span class="n">S</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">R</span> <span class="o">=</span> <span class="n">y</span>
                <span class="k">return</span>  <span class="p">[</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">S</span><span class="p">,</span> <span class="c">#dS/dt</span>
                                <span class="n">beta</span><span class="o">*</span><span class="n">I</span><span class="o">*</span><span class="n">S</span> <span class="o">-</span> <span class="n">tau</span><span class="o">*</span><span class="n">I</span><span class="p">,</span> <span class="c">#dI/dt</span>
                                <span class="n">tau</span><span class="o">*</span><span class="n">I</span><span class="p">]</span> <span class="c">#dR/dt</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">sir</span><span class="p">,</span><span class="n">inits</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="c">#np.arange(t0,tf,step))</span>
        <span class="k">return</span> <span class="n">y</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">FitModel</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">tf</span><span class="p">,[</span><span class="s">&#39;beta&#39;</span><span class="p">],[</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;I&#39;</span><span class="p">,</span><span class="s">&#39;R&#39;</span><span class="p">],</span>
                        <span class="n">wl</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span><span class="n">nw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">F</span><span class="o">.</span><span class="n">set_priors</span><span class="p">(</span><span class="n">tdists</span><span class="o">=</span><span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="p">],</span><span class="n">tpars</span><span class="o">=</span><span class="p">[(</span><span class="mf">1.1</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">)],</span><span class="n">tlims</span><span class="o">=</span><span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)],</span>
        <span class="n">pdists</span><span class="o">=</span><span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">uniform</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">ppars</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">)],</span><span class="n">plims</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mf">1.0</span><span class="p">])</span> <span class="c">#simulate some data</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;I&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">noise</span><span class="p">}</span> <span class="c"># add noise</span>
<span class="n">F</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="s">&#39;MCMC&#39;</span><span class="p">,</span><span class="n">likvar</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span><span class="n">pool</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">monitor</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;I&#39;</span><span class="p">])</span>
<span class="n">F</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>
</div>
<p>The code above starts by defining the models parameters and initial conditions, and a function which takes in the parameters runs the model and returns the output.</p>
<p>After that, we Instantiate our fitting Object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">F</span> <span class="o">=</span> <span class="n">FitModel</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">tf</span><span class="p">,[</span><span class="s">&#39;beta&#39;</span><span class="p">],[</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;I&#39;</span><span class="p">,</span><span class="s">&#39;R&#39;</span><span class="p">],</span>
                        <span class="n">wl</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span><span class="n">nw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we have to pass a few arguments: the first (<tt class="docutils literal"><span class="pre">K=3000</span></tt>) is the number of samples we will take from the joint prior distribution of the parameters to run the inference. The second one (<tt class="docutils literal"><span class="pre">L=1000</span></tt>) is the number to retain if the inference method chosen (see below) in the sampling-importance-resampling (SIR) or approximate Bayes (ABC). then we we have the number of parameters to be analyzed (<tt class="docutils literal"><span class="pre">ntheta=1</span></tt>), the number of output variables (<tt class="docutils literal"><span class="pre">nphi=3</span></tt>), the initial condition vector(<tt class="docutils literal"><span class="pre">inits=y0</span></tt>), the list of parameter names (<tt class="docutils literal"><span class="pre">thetanames</span> <span class="pre">=</span> <span class="pre">['beta']</span></tt>), the list of variable names (<tt class="docutils literal"><span class="pre">phinames=['S','I','R']</span></tt>), inference window length (<tt class="docutils literal"><span class="pre">wl=36</span></tt>), number of juxtaposed windows (<tt class="docutils literal"><span class="pre">nw=1</span></tt>), verbosity flag (<tt class="docutils literal"><span class="pre">verbose=False</span></tt>) and finally the number of burnin samples (<tt class="docutils literal"><span class="pre">burnin=1000</span></tt>), which is only needed for if the inference method chosen is <tt class="docutils literal"><span class="pre">MCMC</span></tt>.</p>
<p>The next line of code also carries a lot of relevant information about the inference: the specification of the prior distributions. By now you must have noticed that not all parameters included in the model need to be included in the analysis. any number of them except for one can be set constant, which is what happens with the parameter <tt class="docutils literal"><span class="pre">tau</span></tt> in this example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">F</span><span class="o">.</span><span class="n">set_priors</span><span class="p">(</span><span class="n">tdists</span><span class="o">=</span><span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="p">],</span><span class="n">tpars</span><span class="o">=</span><span class="p">[(</span><span class="mf">1.1</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">)],</span><span class="n">tlims</span><span class="o">=</span><span class="p">[(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)],</span>
        <span class="n">pdists</span><span class="o">=</span><span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">uniform</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">ppars</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">)],</span><span class="n">plims</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>here we set the prior distributions for the theta (the model&#8217;s parameters) and phi (the model&#8217;s variables). <tt class="docutils literal"><span class="pre">tdists</span></tt>, <tt class="docutils literal"><span class="pre">tpars</span></tt> and <tt class="docutils literal"><span class="pre">tlims</span></tt> are theta&#8217;s distributions, parameters, and ranges. For example here we use a Normal distribution (<tt class="docutils literal"><span class="pre">st.norm</span></tt>) for <tt class="docutils literal"><span class="pre">beta</span></tt>, with mean and standard deviation equal to 1.1 and .2, respectively. we also set the range of <tt class="docutils literal"><span class="pre">beta</span></tt> to be from 0.5 to 1.5. We do the same for phi.</p>
<p>The remaining lines just generate some simulated data to fit the model with, run the inference and plot the results which should include plots like this:</p>
<img alt="_images/fit_series.png" src="_images/fit_series.png" style="width: 15cm;" />
<img alt="_images/fit_par.png" src="_images/fit_par.png" style="width: 15cm;" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             >previous</a> |</li>
        <li><a href="index.html">BIP</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Flávio Codeço Coelho.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>